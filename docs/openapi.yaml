openapi: 3.0.0
info:
    title: API de Partidos de Deportes en Equipo
    description: API para la gestión de usuarios y partidos de deportes en equipo.
    version: 1.2.0
paths:
    /api/users:
        post:
            summary: Crear Usuario
            description: Crea un nuevo usuario en el sistema. El campo `username` debe ser único; el `email` puede repetirse.
            operationId: createUser
            requestBody:
                description: Datos del nuevo usuario
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/UserInput"
            responses:
                "201":
                    description: Usuario creado exitosamente
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/User"
                "400":
                    $ref: "#/components/responses/BadRequest"
                "409":
                    $ref: "#/components/responses/Conflict"
    /api/users/{id}:
        get:
            summary: Obtener Detalles de Usuario
            description: Obtiene la información de un usuario por su ID.
            operationId: getUser
            parameters:
                - name: id
                  in: path
                  description: ID único del usuario (UUID)
                  required: true
                  schema:
                      type: string
                      format: uuid
            responses:
                "200":
                    description: Detalles del usuario
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/User"
                "404":
                    $ref: "#/components/responses/NotFound"
        patch:
            summary: Actualizar Usuario
            description: Actualiza la información de un usuario existente.
            operationId: updateUser
            parameters:
                - name: id
                  in: path
                  description: ID único del usuario (UUID)
                  required: true
                  schema:
                      type: string
                      format: uuid
            requestBody:
                description: Datos a actualizar
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/UserUpdate"
            responses:
                "200":
                    description: Usuario actualizado exitosamente
                    content:
                        application/json:
                            schema:
                                $ref: "#/components/schemas/User"
                "400":
                    $ref: "#/components/responses/BadRequest"
                "404":
                    $ref: "#/components/responses/NotFound"
                "409":
                    $ref: "#/components/responses/Conflict"
    /api/users/{id}/password:
        patch:
            summary: Actualizar Contraseña de Usuario
            description: Actualiza únicamente la contraseña de un usuario existente.
            operationId: updatePassword
            parameters:
                - name: id
                  in: path
                  description: ID único del usuario (UUID)
                  required: true
                  schema:
                      type: string
                      format: uuid
            requestBody:
                description: Nueva contraseña
                required: true
                content:
                    application/json:
                        schema:
                            $ref: "#/components/schemas/UserPasswordUpdate"
            responses:
                "204":
                    description: Contraseña actualizada exitosamente
                "400":
                    $ref: "#/components/responses/BadRequest"
                "404":
                    $ref: "#/components/responses/NotFound"
    /api/users/test/protected:
        get:
            summary: Ruta Protegida de Prueba
            description: Endpoint para verificar el funcionamiento del middleware de autenticación.
            operationId: testProtected
            security:
                - bearerAuth: []
            responses:
                "200":
                    description: Acceso concedido
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    message:
                                        type: string
                                        example: "Secret content"
                "401":
                    description: No autorizado

components:
    securitySchemes:
        bearerAuth:
            type: http
            scheme: bearer
            bearerFormat: JWT
    schemas:
        User:
            type: object
            properties:
                id:
                    type: string
                    format: uuid
                    description: Identificador único del usuario.
                username:
                    type: string
                    description: Nombre de usuario único del usuario.
                email:
                    type: string
                    format: email
                    description: Correo electrónico de contacto (no es único).
                name:
                    type: string
                    description: Nombre completo del usuario.
                isActive:
                    type: boolean
                    description: Indica si el usuario está activo.
                createdAt:
                    type: string
                    format: date-time
                    description: Fecha de creación.
                updatedAt:
                    type: string
                    format: date-time
                    description: Fecha de última actualización.
            required:
                - id
                - username
                - email
                - name
                - isActive
                - createdAt
                - updatedAt

        UserInput:
            type: object
            properties:
                username:
                    type: string
                    description: Nombre de usuario único. Usado para autenticación.
                email:
                    type: string
                    format: email
                    description: Correo electrónico de contacto (no es único).
                name:
                    type: string
                    description: Nombre completo del usuario.
                password:
                    type: string
                    writeOnly: true
                    description: Contraseña del usuario (se almacenará como hash).
            required:
                - username
                - email
                - name
                - password

        UserUpdate:
            type: object
            properties:
                username:
                    type: string
                    description: Nuevo nombre de usuario (debe ser único).
                email:
                    type: string
                    format: email
                    description: Nuevo correo electrónico.
                name:
                    type: string
                    description: Nuevo nombre.
                isActive:
                    type: boolean
                    description: Nuevo estado.

        UserPasswordUpdate:
            type: object
            properties:
                password:
                    type: string
                    writeOnly: true
                    description: Nueva contraseña (se almacenará como hash).
            required:
                - password

    responses:
        BadRequest:
            description: Solicitud incorrecta (ej. datos de validación fallidos).
            content:
                application/json:
                    schema:
                        type: object
                        properties:
                            error:
                                type: string
                                example: "Email inválido"
        NotFound:
            description: Recurso no encontrado.
            content:
                application/json:
                    schema:
                        type: object
                        properties:
                            error:
                                type: string
                                example: "Usuario no encontrado"
        Conflict:
            description: Conflicto (ej. username ya existente).
            content:
                application/json:
                    schema:
                        type: object
                        properties:
                            error:
                                type: string
                                example: "El username ya está en uso"
